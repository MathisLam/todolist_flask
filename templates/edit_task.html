{% extends "layout.html" %}

{% block title %}
    Edit Task - {{ super() }}
{% endblock %}

{% block content %}
<div class="form-container">
    <h2>Edit Task</h2>
    
    <!-- This form is now CORRECTLY using method="post" -->
    <form action="{{ url_for('edit_task', task_id=task.id) }}" method="post" class="styled-form">
        
        <div class="form-group">
            <label for="content">Task Name</label>
            <input type="text" id="content" name="content" required value="{{ task.content }}">
        </div>
        
        <div class="form-group">
            <label for="category">Category (Class)</label>
            <input type="text" id="category" name="category" value="{{ task.category or '' }}">
        </div>
        
        <div class="form-group">
            <!-- This is the fixed, safe date input -->
            <label for="due_date">Due Date</label>
            {% set due_date_val = task.due_date | string %}
            {% if due_date_val %}
                {% set due_date_val = due_date_val.split('.')[0] %}
                {% if 'T' not in due_date_val %}
                    {% set due_date_val = due_date_val.replace(' ', 'T') %}
                {% endif %}
                {% if due_date_val.count(':') > 1 %}
                    {% set due_date_val = due_date_val[0:due_date_val.rfind(':')] %}
                {% endif %}
            {% endif %}
            <input type="datetime-local" id="due_date" name="due_date" value="{{ due_date_val if due_date_val else '' }}">
        </div>
        
        <div class="form-group">
            <label for="status">Status</label>
            <select id="status" name="status">
                <option value="upcoming" {% if task.status == 'upcoming' %}selected{% endif %}>Upcoming</option>
                <option value="in_process" {% if task.status == 'in_process' %}selected{% endif %}>In Process</option>
                <option value="completed" {% if task.status == 'completed' %}selected{% endif %}>Completed</option>
            </select>
        </div>
        
        <div class="form-group-horizontal">
            <button type="submit" class="button-primary">Save Changes</button>
            <a href="{{ url_for('home') }}" class="button-secondary">Cancel</a>
        </div>
        
    </form>
    
    <!-- Delete Button Form -->
    <form action="{{ url_for('delete_task', task_id=task.id) }}" method="post" class="delete-form">
        <button type="submit" class="button-danger" onclick="return confirm('Are you sure you want to delete this task?');">
            Delete Task
        </button>
    </form>
</div>
{% endblock %}

